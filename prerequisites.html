<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>4 Prerequisites | Analysis workflow for IMC data</title>
  <meta name="description" content="This bookdown project highlights possible down-stream analyses performed on imaging mass cytometry data." />
  <meta name="generator" content="bookdown 0.37 and GitBook 2.6.7" />

  <meta property="og:title" content="4 Prerequisites | Analysis workflow for IMC data" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This bookdown project highlights possible down-stream analyses performed on imaging mass cytometry data." />
  <meta name="github-repo" content="BodenmillerGroup/IMCDataAnalysis" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4 Prerequisites | Analysis workflow for IMC data" />
  
  <meta name="twitter:description" content="This bookdown project highlights possible down-stream analyses performed on imaging mass cytometry data." />
  

<meta name="author" content="Authors: Nils Eling 1,2,*, Vito Zanotelli 1,2, Michelle Daniel 1,2, Daniel Schulz 1,2, Jonas Windhager 1,2, Lasse Meyer 1,2" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="processing.html"/>
<link rel="next" href="read-data.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Multiplexed imaging data analysis</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> IMC Data Analysis Workflow</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#disclaimer"><i class="fa fa-check"></i><b>1.1</b> Disclaimer</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#update-freeze"><i class="fa fa-check"></i><b>1.2</b> Update freeze</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#feedback-and-contributing"><i class="fa fa-check"></i><b>1.3</b> Feedback and contributing</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#maintainer"><i class="fa fa-check"></i><b>1.4</b> Maintainer</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#contributors"><i class="fa fa-check"></i><b>1.5</b> Contributors</a></li>
<li class="chapter" data-level="1.6" data-path="index.html"><a href="index.html#citation"><i class="fa fa-check"></i><b>1.6</b> Citation</a></li>
<li class="chapter" data-level="1.7" data-path="index.html"><a href="index.html#changelog"><i class="fa fa-check"></i><b>1.7</b> Changelog</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>2</b> Introduction</a>
<ul>
<li class="chapter" data-level="2.1" data-path="intro.html"><a href="intro.html#technical-details-of-imc"><i class="fa fa-check"></i><b>2.1</b> Technical details of IMC</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="intro.html"><a href="intro.html#metal-conjugated-antobodies-and-staining"><i class="fa fa-check"></i><b>2.1.1</b> Metal-conjugated antobodies and staining</a></li>
<li class="chapter" data-level="2.1.2" data-path="intro.html"><a href="intro.html#data-acquisition"><i class="fa fa-check"></i><b>2.1.2</b> Data acquisition</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="intro.html"><a href="intro.html#data-format"><i class="fa fa-check"></i><b>2.2</b> IMC data format</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="processing.html"><a href="processing.html"><i class="fa fa-check"></i><b>3</b> Multi-channel image processing</a>
<ul>
<li class="chapter" data-level="3.1" data-path="processing.html"><a href="processing.html#image-pre-processing-imc-specific"><i class="fa fa-check"></i><b>3.1</b> Image pre-processing (IMC specific)</a></li>
<li class="chapter" data-level="3.2" data-path="processing.html"><a href="processing.html#image-segmentation"><i class="fa fa-check"></i><b>3.2</b> Image segmentation</a></li>
<li class="chapter" data-level="3.3" data-path="processing.html"><a href="processing.html#feature-extraction"><i class="fa fa-check"></i><b>3.3</b> Feature extraction</a></li>
<li class="chapter" data-level="3.4" data-path="processing.html"><a href="processing.html#data-export"><i class="fa fa-check"></i><b>3.4</b> Data export</a></li>
<li class="chapter" data-level="3.5" data-path="processing.html"><a href="processing.html#data-import-into-r"><i class="fa fa-check"></i><b>3.5</b> Data import into R</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="prerequisites.html"><a href="prerequisites.html"><i class="fa fa-check"></i><b>4</b> Prerequisites</a>
<ul>
<li class="chapter" data-level="4.1" data-path="prerequisites.html"><a href="prerequisites.html#obtain-the-code"><i class="fa fa-check"></i><b>4.1</b> Obtain the code</a></li>
<li class="chapter" data-level="4.2" data-path="prerequisites.html"><a href="prerequisites.html#software-requirements"><i class="fa fa-check"></i><b>4.2</b> Software requirements</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="prerequisites.html"><a href="prerequisites.html#docker"><i class="fa fa-check"></i><b>4.2.1</b> Using Docker</a></li>
<li class="chapter" data-level="4.2.2" data-path="prerequisites.html"><a href="prerequisites.html#manual-install"><i class="fa fa-check"></i><b>4.2.2</b> Manual installation</a></li>
<li class="chapter" data-level="4.2.3" data-path="prerequisites.html"><a href="prerequisites.html#major-package-versions"><i class="fa fa-check"></i><b>4.2.3</b> Major package versions</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="prerequisites.html"><a href="prerequisites.html#image-processing"><i class="fa fa-check"></i><b>4.3</b> Image processing</a></li>
<li class="chapter" data-level="4.4" data-path="prerequisites.html"><a href="prerequisites.html#download-data"><i class="fa fa-check"></i><b>4.4</b> Download example data</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="prerequisites.html"><a href="prerequisites.html#processed-multiplexed-imaging-data"><i class="fa fa-check"></i><b>4.4.1</b> Processed multiplexed imaging data</a></li>
<li class="chapter" data-level="4.4.2" data-path="prerequisites.html"><a href="prerequisites.html#files-for-spillover-matrix-estimation"><i class="fa fa-check"></i><b>4.4.2</b> Files for spillover matrix estimation</a></li>
<li class="chapter" data-level="4.4.3" data-path="prerequisites.html"><a href="prerequisites.html#gated-cells"><i class="fa fa-check"></i><b>4.4.3</b> Gated cells</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="prerequisites.html"><a href="prerequisites.html#sessionInfo"><i class="fa fa-check"></i><b>4.5</b> Software versions</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="read-data.html"><a href="read-data.html"><i class="fa fa-check"></i><b>5</b> Read in the data</a>
<ul>
<li class="chapter" data-level="5.1" data-path="read-data.html"><a href="read-data.html#read-in-single-cell-information"><i class="fa fa-check"></i><b>5.1</b> Read in single-cell information</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="read-data.html"><a href="read-data.html#steinbock-generated-data"><i class="fa fa-check"></i><b>5.1.1</b> steinbock generated data</a></li>
<li class="chapter" data-level="5.1.2" data-path="read-data.html"><a href="read-data.html#imc-segmentation-pipeline-generated-data"><i class="fa fa-check"></i><b>5.1.2</b> IMC Segmentation Pipeline generated data</a></li>
<li class="chapter" data-level="5.1.3" data-path="read-data.html"><a href="read-data.html#reading-custom-files"><i class="fa fa-check"></i><b>5.1.3</b> Reading custom files</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="read-data.html"><a href="read-data.html#cell-processing"><i class="fa fa-check"></i><b>5.2</b> Single-cell processing</a></li>
<li class="chapter" data-level="5.3" data-path="read-data.html"><a href="read-data.html#read-images"><i class="fa fa-check"></i><b>5.3</b> Read in images</a></li>
<li class="chapter" data-level="5.4" data-path="read-data.html"><a href="read-data.html#generate-single-cell-data-from-images"><i class="fa fa-check"></i><b>5.4</b> Generate single-cell data from images</a></li>
<li class="chapter" data-level="5.5" data-path="read-data.html"><a href="read-data.html#accessing-publicly-available-imc-datasets"><i class="fa fa-check"></i><b>5.5</b> Accessing publicly available IMC datasets</a></li>
<li class="chapter" data-level="5.6" data-path="read-data.html"><a href="read-data.html#save-objects"><i class="fa fa-check"></i><b>5.6</b> Save objects</a></li>
<li class="chapter" data-level="5.7" data-path="read-data.html"><a href="read-data.html#session-info"><i class="fa fa-check"></i><b>5.7</b> Session Info</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="spillover-correction.html"><a href="spillover-correction.html"><i class="fa fa-check"></i><b>6</b> Spillover correction</a>
<ul>
<li class="chapter" data-level="6.1" data-path="spillover-correction.html"><a href="spillover-correction.html#generate-the-spillover-matrix"><i class="fa fa-check"></i><b>6.1</b> Generate the spillover matrix</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="spillover-correction.html"><a href="spillover-correction.html#read-in-the-data"><i class="fa fa-check"></i><b>6.1.1</b> Read in the data</a></li>
<li class="chapter" data-level="6.1.2" data-path="spillover-correction.html"><a href="spillover-correction.html#quality-control"><i class="fa fa-check"></i><b>6.1.2</b> Quality control</a></li>
<li class="chapter" data-level="6.1.3" data-path="spillover-correction.html"><a href="spillover-correction.html#pixel_binning"><i class="fa fa-check"></i><b>6.1.3</b> Optional pixel binning</a></li>
<li class="chapter" data-level="6.1.4" data-path="spillover-correction.html"><a href="spillover-correction.html#filtering-incorrectly-assigned-pixels"><i class="fa fa-check"></i><b>6.1.4</b> Filtering incorrectly assigned pixels</a></li>
<li class="chapter" data-level="6.1.5" data-path="spillover-correction.html"><a href="spillover-correction.html#compute-spillover-matrix"><i class="fa fa-check"></i><b>6.1.5</b> Compute spillover matrix</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="spillover-correction.html"><a href="spillover-correction.html#single-cell-data-compensation"><i class="fa fa-check"></i><b>6.2</b> Single-cell data compensation</a></li>
<li class="chapter" data-level="6.3" data-path="spillover-correction.html"><a href="spillover-correction.html#image-compensation"><i class="fa fa-check"></i><b>6.3</b> Image compensation</a></li>
<li class="chapter" data-level="6.4" data-path="spillover-correction.html"><a href="spillover-correction.html#write-out-compensated-images"><i class="fa fa-check"></i><b>6.4</b> Write out compensated images</a></li>
<li class="chapter" data-level="6.5" data-path="spillover-correction.html"><a href="spillover-correction.html#save-objects-1"><i class="fa fa-check"></i><b>6.5</b> Save objects</a></li>
<li class="chapter" data-level="6.6" data-path="spillover-correction.html"><a href="spillover-correction.html#session-info-1"><i class="fa fa-check"></i><b>6.6</b> Session Info</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="image-and-cell-level-quality-control.html"><a href="image-and-cell-level-quality-control.html"><i class="fa fa-check"></i><b>7</b> Image and cell-level quality control</a>
<ul>
<li class="chapter" data-level="7.1" data-path="image-and-cell-level-quality-control.html"><a href="image-and-cell-level-quality-control.html#read-in-the-data-1"><i class="fa fa-check"></i><b>7.1</b> Read in the data</a></li>
<li class="chapter" data-level="7.2" data-path="image-and-cell-level-quality-control.html"><a href="image-and-cell-level-quality-control.html#seg-quality"><i class="fa fa-check"></i><b>7.2</b> Segmentation quality control</a></li>
<li class="chapter" data-level="7.3" data-path="image-and-cell-level-quality-control.html"><a href="image-and-cell-level-quality-control.html#image-quality"><i class="fa fa-check"></i><b>7.3</b> Image-level quality control</a></li>
<li class="chapter" data-level="7.4" data-path="image-and-cell-level-quality-control.html"><a href="image-and-cell-level-quality-control.html#cell-quality"><i class="fa fa-check"></i><b>7.4</b> Cell-level quality control</a></li>
<li class="chapter" data-level="7.5" data-path="image-and-cell-level-quality-control.html"><a href="image-and-cell-level-quality-control.html#save-objects-2"><i class="fa fa-check"></i><b>7.5</b> Save objects</a></li>
<li class="chapter" data-level="7.6" data-path="image-and-cell-level-quality-control.html"><a href="image-and-cell-level-quality-control.html#session-info-2"><i class="fa fa-check"></i><b>7.6</b> Session Info</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="batch-effects.html"><a href="batch-effects.html"><i class="fa fa-check"></i><b>8</b> Batch effect correction</a>
<ul>
<li class="chapter" data-level="8.1" data-path="batch-effects.html"><a href="batch-effects.html#fastmnn-correction"><i class="fa fa-check"></i><b>8.1</b> fastMNN correction</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="batch-effects.html"><a href="batch-effects.html#perform-sample-correction"><i class="fa fa-check"></i><b>8.1.1</b> Perform sample correction</a></li>
<li class="chapter" data-level="8.1.2" data-path="batch-effects.html"><a href="batch-effects.html#quality-control-of-correction-results"><i class="fa fa-check"></i><b>8.1.2</b> Quality control of correction results</a></li>
<li class="chapter" data-level="8.1.3" data-path="batch-effects.html"><a href="batch-effects.html#visualization"><i class="fa fa-check"></i><b>8.1.3</b> Visualization</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="batch-effects.html"><a href="batch-effects.html#harmony-correction"><i class="fa fa-check"></i><b>8.2</b> harmony correction</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="batch-effects.html"><a href="batch-effects.html#visualization-1"><i class="fa fa-check"></i><b>8.2.1</b> Visualization</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="batch-effects.html"><a href="batch-effects.html#seurat-correction"><i class="fa fa-check"></i><b>8.3</b> Seurat correction</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="batch-effects.html"><a href="batch-effects.html#visualization-2"><i class="fa fa-check"></i><b>8.3.1</b> Visualization</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="batch-effects.html"><a href="batch-effects.html#save-objects-3"><i class="fa fa-check"></i><b>8.4</b> Save objects</a></li>
<li class="chapter" data-level="8.5" data-path="batch-effects.html"><a href="batch-effects.html#session-info-3"><i class="fa fa-check"></i><b>8.5</b> Session Info</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="cell-phenotyping.html"><a href="cell-phenotyping.html"><i class="fa fa-check"></i><b>9</b> Cell phenotyping</a>
<ul>
<li class="chapter" data-level="9.1" data-path="cell-phenotyping.html"><a href="cell-phenotyping.html#load-data"><i class="fa fa-check"></i><b>9.1</b> Load data</a></li>
<li class="chapter" data-level="9.2" data-path="cell-phenotyping.html"><a href="cell-phenotyping.html#clustering"><i class="fa fa-check"></i><b>9.2</b> Clustering approaches</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="cell-phenotyping.html"><a href="cell-phenotyping.html#rphenograph"><i class="fa fa-check"></i><b>9.2.1</b> Rphenograph</a></li>
<li class="chapter" data-level="9.2.2" data-path="cell-phenotyping.html"><a href="cell-phenotyping.html#snn-graph"><i class="fa fa-check"></i><b>9.2.2</b> Shared nearest neighbour graph</a></li>
<li class="chapter" data-level="9.2.3" data-path="cell-phenotyping.html"><a href="cell-phenotyping.html#self-organizing-maps"><i class="fa fa-check"></i><b>9.2.3</b> Self organizing maps</a></li>
<li class="chapter" data-level="9.2.4" data-path="cell-phenotyping.html"><a href="cell-phenotyping.html#compare-between-clustering-approaches"><i class="fa fa-check"></i><b>9.2.4</b> Compare between clustering approaches</a></li>
<li class="chapter" data-level="9.2.5" data-path="cell-phenotyping.html"><a href="cell-phenotyping.html#clustering-notes"><i class="fa fa-check"></i><b>9.2.5</b> Further clustering notes</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="cell-phenotyping.html"><a href="cell-phenotyping.html#classification"><i class="fa fa-check"></i><b>9.3</b> Classification approach</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="cell-phenotyping.html"><a href="cell-phenotyping.html#manual-labeling-of-cells"><i class="fa fa-check"></i><b>9.3.1</b> Manual labeling of cells</a></li>
<li class="chapter" data-level="9.3.2" data-path="cell-phenotyping.html"><a href="cell-phenotyping.html#define-color-vectors"><i class="fa fa-check"></i><b>9.3.2</b> Define color vectors</a></li>
<li class="chapter" data-level="9.3.3" data-path="cell-phenotyping.html"><a href="cell-phenotyping.html#read-in-and-consolidate-labeled-data"><i class="fa fa-check"></i><b>9.3.3</b> Read in and consolidate labeled data</a></li>
<li class="chapter" data-level="9.3.4" data-path="cell-phenotyping.html"><a href="cell-phenotyping.html#train-classifier"><i class="fa fa-check"></i><b>9.3.4</b> Train classifier</a></li>
<li class="chapter" data-level="9.3.5" data-path="cell-phenotyping.html"><a href="cell-phenotyping.html#classifier-performance"><i class="fa fa-check"></i><b>9.3.5</b> Classifier performance</a></li>
<li class="chapter" data-level="9.3.6" data-path="cell-phenotyping.html"><a href="cell-phenotyping.html#classification-of-new-data"><i class="fa fa-check"></i><b>9.3.6</b> Classification of new data</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="cell-phenotyping.html"><a href="cell-phenotyping.html#session-info-4"><i class="fa fa-check"></i><b>9.4</b> Session Info</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="single-cell-visualization.html"><a href="single-cell-visualization.html"><i class="fa fa-check"></i><b>10</b> Single cell visualization</a>
<ul>
<li class="chapter" data-level="10.1" data-path="single-cell-visualization.html"><a href="single-cell-visualization.html#load-data-1"><i class="fa fa-check"></i><b>10.1</b> Load data</a></li>
<li class="chapter" data-level="10.2" data-path="single-cell-visualization.html"><a href="single-cell-visualization.html#cell-type-level"><i class="fa fa-check"></i><b>10.2</b> Cell-type level</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="single-cell-visualization.html"><a href="single-cell-visualization.html#dimensionality-reduction-visualization"><i class="fa fa-check"></i><b>10.2.1</b> Dimensionality reduction visualization</a></li>
<li class="chapter" data-level="10.2.2" data-path="single-cell-visualization.html"><a href="single-cell-visualization.html#heatmap-visualization"><i class="fa fa-check"></i><b>10.2.2</b> Heatmap visualization</a></li>
<li class="chapter" data-level="10.2.3" data-path="single-cell-visualization.html"><a href="single-cell-visualization.html#violin-plot-visualization"><i class="fa fa-check"></i><b>10.2.3</b> Violin plot visualization</a></li>
<li class="chapter" data-level="10.2.4" data-path="single-cell-visualization.html"><a href="single-cell-visualization.html#scatter-plot-visualization"><i class="fa fa-check"></i><b>10.2.4</b> Scatter plot visualization</a></li>
<li class="chapter" data-level="10.2.5" data-path="single-cell-visualization.html"><a href="single-cell-visualization.html#barplot-visualization"><i class="fa fa-check"></i><b>10.2.5</b> Barplot visualization</a></li>
<li class="chapter" data-level="10.2.6" data-path="single-cell-visualization.html"><a href="single-cell-visualization.html#catalyst-based-visualization"><i class="fa fa-check"></i><b>10.2.6</b> CATALYST-based visualization</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="single-cell-visualization.html"><a href="single-cell-visualization.html#sample-level"><i class="fa fa-check"></i><b>10.3</b> Sample-level</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="single-cell-visualization.html"><a href="single-cell-visualization.html#dimensionality-reduction-visualization-1"><i class="fa fa-check"></i><b>10.3.1</b> Dimensionality reduction visualization</a></li>
<li class="chapter" data-level="10.3.2" data-path="single-cell-visualization.html"><a href="single-cell-visualization.html#heatmap-visualization-1"><i class="fa fa-check"></i><b>10.3.2</b> Heatmap visualization</a></li>
<li class="chapter" data-level="10.3.3" data-path="single-cell-visualization.html"><a href="single-cell-visualization.html#barplot-visualization-1"><i class="fa fa-check"></i><b>10.3.3</b> Barplot visualization</a></li>
<li class="chapter" data-level="10.3.4" data-path="single-cell-visualization.html"><a href="single-cell-visualization.html#catalyst-based-visualization-1"><i class="fa fa-check"></i><b>10.3.4</b> CATALYST-based visualization</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="single-cell-visualization.html"><a href="single-cell-visualization.html#rich-example"><i class="fa fa-check"></i><b>10.4</b> Further examples</a>
<ul>
<li class="chapter" data-level="10.4.1" data-path="single-cell-visualization.html"><a href="single-cell-visualization.html#publication-ready-complexheatmap"><i class="fa fa-check"></i><b>10.4.1</b> Publication-ready ComplexHeatmap</a></li>
<li class="chapter" data-level="10.4.2" data-path="single-cell-visualization.html"><a href="single-cell-visualization.html#interactive-visualization"><i class="fa fa-check"></i><b>10.4.2</b> Interactive visualization</a></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="single-cell-visualization.html"><a href="single-cell-visualization.html#session-info-5"><i class="fa fa-check"></i><b>10.5</b> Session Info</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="image-visualization.html"><a href="image-visualization.html"><i class="fa fa-check"></i><b>11</b> Image visualization</a>
<ul>
<li class="chapter" data-level="11.1" data-path="image-visualization.html"><a href="image-visualization.html#pixel-visualization"><i class="fa fa-check"></i><b>11.1</b> Pixel visualization</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="image-visualization.html"><a href="image-visualization.html#adjusting-colors"><i class="fa fa-check"></i><b>11.1.1</b> Adjusting colors</a></li>
<li class="chapter" data-level="11.1.2" data-path="image-visualization.html"><a href="image-visualization.html#image-normalization"><i class="fa fa-check"></i><b>11.1.2</b> Image normalization</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="image-visualization.html"><a href="image-visualization.html#mask-visualization"><i class="fa fa-check"></i><b>11.2</b> Cell visualization</a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="image-visualization.html"><a href="image-visualization.html#visualzing-metadata"><i class="fa fa-check"></i><b>11.2.1</b> Visualzing metadata</a></li>
<li class="chapter" data-level="11.2.2" data-path="image-visualization.html"><a href="image-visualization.html#visualizating-expression"><i class="fa fa-check"></i><b>11.2.2</b> Visualizating expression</a></li>
<li class="chapter" data-level="11.2.3" data-path="image-visualization.html"><a href="image-visualization.html#outline-cells"><i class="fa fa-check"></i><b>11.2.3</b> Outlining cells on images</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="image-visualization.html"><a href="image-visualization.html#adjusting-plot-annotations"><i class="fa fa-check"></i><b>11.3</b> Adjusting plot annotations</a></li>
<li class="chapter" data-level="11.4" data-path="image-visualization.html"><a href="image-visualization.html#displaying-individual-images"><i class="fa fa-check"></i><b>11.4</b> Displaying individual images</a></li>
<li class="chapter" data-level="11.5" data-path="image-visualization.html"><a href="image-visualization.html#saving-and-returning-images"><i class="fa fa-check"></i><b>11.5</b> Saving and returning images</a></li>
<li class="chapter" data-level="11.6" data-path="image-visualization.html"><a href="image-visualization.html#cytoviewer"><i class="fa fa-check"></i><b>11.6</b> Interactive image visualization</a></li>
<li class="chapter" data-level="11.7" data-path="image-visualization.html"><a href="image-visualization.html#session-info-6"><i class="fa fa-check"></i><b>11.7</b> Session Info</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="performing-spatial-analysis.html"><a href="performing-spatial-analysis.html"><i class="fa fa-check"></i><b>12</b> Performing spatial analysis</a>
<ul>
<li class="chapter" data-level="12.1" data-path="performing-spatial-analysis.html"><a href="performing-spatial-analysis.html#spatial-interaction-graphs"><i class="fa fa-check"></i><b>12.1</b> Spatial interaction graphs</a></li>
<li class="chapter" data-level="12.2" data-path="performing-spatial-analysis.html"><a href="performing-spatial-analysis.html#spatial-viz"><i class="fa fa-check"></i><b>12.2</b> Spatial visualization</a></li>
<li class="chapter" data-level="12.3" data-path="performing-spatial-analysis.html"><a href="performing-spatial-analysis.html#spatial-community-analysis"><i class="fa fa-check"></i><b>12.3</b> Spatial community analysis</a></li>
<li class="chapter" data-level="12.4" data-path="performing-spatial-analysis.html"><a href="performing-spatial-analysis.html#cellular-neighborhood-analysis"><i class="fa fa-check"></i><b>12.4</b> Cellular neighborhood analysis</a></li>
<li class="chapter" data-level="12.5" data-path="performing-spatial-analysis.html"><a href="performing-spatial-analysis.html#spatial-context-analysis"><i class="fa fa-check"></i><b>12.5</b> Spatial context analysis</a></li>
<li class="chapter" data-level="12.6" data-path="performing-spatial-analysis.html"><a href="performing-spatial-analysis.html#patch-detection"><i class="fa fa-check"></i><b>12.6</b> Patch detection</a></li>
<li class="chapter" data-level="12.7" data-path="performing-spatial-analysis.html"><a href="performing-spatial-analysis.html#interaction-analysis"><i class="fa fa-check"></i><b>12.7</b> Interaction analysis</a></li>
<li class="chapter" data-level="12.8" data-path="performing-spatial-analysis.html"><a href="performing-spatial-analysis.html#session-info-7"><i class="fa fa-check"></i><b>12.8</b> Session Info</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Analysis workflow for IMC data</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="prerequisites" class="section level1 hasAnchor" number="4">
<h1><span class="header-section-number">4</span> Prerequisites<a href="prerequisites.html#prerequisites" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>The analysis presented in this book requires a basic understanding of the
<code>R</code> programing language. An introduction to <code>R</code> can be found <a href="https://cran.r-project.org/doc/manuals/r-release/R-intro.pdf">here</a> and
in the book <a href="https://r4ds.hadley.nz/">R for Data Science</a>.</p>
<p>Furthermore, it is beneficial to be familiar with single-cell data analysis
using the <a href="https://www.bioconductor.org/">Bioconductor</a> framework. The
<a href="https://bioconductor.org/books/release/OSCA/">Orchestrating Single-Cell Analysis with Bioconductor</a> book
gives an excellent overview on data containers and basic analysis that are being
used here.</p>
<p>An overview on IMC as technology and necessary image processing steps can be
found on the <a href="https://bodenmillergroup.github.io/IMCWorkflow/">IMC workflow website</a>.</p>
<p>Before we get started on IMC data analysis, we will need to make sure that
software dependencies are installed and the example data is downloaded.</p>
<div id="obtain-the-code" class="section level2 hasAnchor" number="4.1">
<h2><span class="header-section-number">4.1</span> Obtain the code<a href="prerequisites.html#obtain-the-code" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This book provides R code to perform single-cell and spatial data analysis.
You can copy the individual code chunks into your R scripts or you can obtain
the full code of the book via:</p>
<pre><code>git clone https://github.com/BodenmillerGroup/IMCDataAnalysis.git</code></pre>
</div>
<div id="software-requirements" class="section level2 hasAnchor" number="4.2">
<h2><span class="header-section-number">4.2</span> Software requirements<a href="prerequisites.html#software-requirements" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The R packages needed to execute the presented workflow can either be manually
installed (see section <a href="prerequisites.html#manual-install">4.2.2</a>) or are available within a provided
Docker container (see section <a href="prerequisites.html#docker">4.2.1</a>). The Docker option is useful if you
want to exactly reproduce the presented analysis across operating systems;
however, the manual install gives you more flexibility for exploratory data
analysis.</p>
<div id="docker" class="section level3 hasAnchor" number="4.2.1">
<h3><span class="header-section-number">4.2.1</span> Using Docker<a href="prerequisites.html#docker" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>For reproducibility purposes, we provide a Docker container <a href="https://github.com/BodenmillerGroup/IMCDataAnalysis/pkgs/container/imcdataanalysis">here</a>.</p>
<ol style="list-style-type: decimal">
<li>After installing <a href="https://docs.docker.com/get-docker/">Docker</a> you can first pull the container via:</li>
</ol>
<pre><code>docker pull ghcr.io/bodenmillergroup/imcdataanalysis:latest</code></pre>
<p>and then run the container:</p>
<pre><code>docker run -v /path/to/IMCDataAnalysis:/home/rstudio/IMCDataAnalysis \
    -e PASSWORD=bioc -p 8787:8787  \
    ghcr.io/bodenmillergroup/imcdataanalysis:latest</code></pre>
<p>Here, the <code>/path/to/</code> needs to be adjusted to where you keep the code and data
of the book.</p>
<p><strong>Of note: it is recommended to use a date-tagged version of the container to ensure reproducibility</strong>.
This can be done via:</p>
<pre><code>docker pull ghcr.io/bodenmillergroup/imcdataanalysis:&lt;year-month-date&gt;</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>An RStudio server session can be accessed via a browser at <code>localhost:8787</code> using <code>Username: rstudio</code> and <code>Password: bioc</code>.<br />
</li>
<li>Navigate to <code>IMCDataAnalysis</code> and open the <code>IMCDataAnalysis.Rproj</code> file.<br />
</li>
<li>Code in the individual files can now be executed or the whole workflow can be build by entering <code>bookdown::render_book()</code>.</li>
</ol>
</div>
<div id="manual-install" class="section level3 hasAnchor" number="4.2.2">
<h3><span class="header-section-number">4.2.2</span> Manual installation<a href="prerequisites.html#manual-install" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The following section describes how to manually install all needed R packages
when not using the provided Docker container.
To install all R packages needed for the analysis, please run:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="prerequisites.html#cb7-1" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">requireNamespace</span>(<span class="st">&quot;BiocManager&quot;</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>))</span>
<span id="cb7-2"><a href="prerequisites.html#cb7-2" tabindex="-1"></a>    <span class="fu">install.packages</span>(<span class="st">&quot;BiocManager&quot;</span>)</span>
<span id="cb7-3"><a href="prerequisites.html#cb7-3" tabindex="-1"></a></span>
<span id="cb7-4"><a href="prerequisites.html#cb7-4" tabindex="-1"></a>BiocManager<span class="sc">::</span><span class="fu">install</span>(<span class="fu">c</span>(<span class="st">&quot;rmarkdown&quot;</span>, <span class="st">&quot;bookdown&quot;</span>, <span class="st">&quot;pheatmap&quot;</span>, <span class="st">&quot;viridis&quot;</span>, <span class="st">&quot;zoo&quot;</span>, </span>
<span id="cb7-5"><a href="prerequisites.html#cb7-5" tabindex="-1"></a>                       <span class="st">&quot;devtools&quot;</span>, <span class="st">&quot;testthat&quot;</span>, <span class="st">&quot;tiff&quot;</span>, <span class="st">&quot;distill&quot;</span>, <span class="st">&quot;ggrepel&quot;</span>, </span>
<span id="cb7-6"><a href="prerequisites.html#cb7-6" tabindex="-1"></a>                       <span class="st">&quot;patchwork&quot;</span>, <span class="st">&quot;mclust&quot;</span>, <span class="st">&quot;RColorBrewer&quot;</span>, <span class="st">&quot;uwot&quot;</span>, <span class="st">&quot;Rtsne&quot;</span>, </span>
<span id="cb7-7"><a href="prerequisites.html#cb7-7" tabindex="-1"></a>                       <span class="st">&quot;harmony&quot;</span>, <span class="st">&quot;Seurat&quot;</span>, <span class="st">&quot;SeuratObject&quot;</span>, <span class="st">&quot;cowplot&quot;</span>, <span class="st">&quot;kohonen&quot;</span>, </span>
<span id="cb7-8"><a href="prerequisites.html#cb7-8" tabindex="-1"></a>                       <span class="st">&quot;caret&quot;</span>, <span class="st">&quot;randomForest&quot;</span>, <span class="st">&quot;ggridges&quot;</span>, <span class="st">&quot;cowplot&quot;</span>, </span>
<span id="cb7-9"><a href="prerequisites.html#cb7-9" tabindex="-1"></a>                       <span class="st">&quot;gridGraphics&quot;</span>, <span class="st">&quot;scales&quot;</span>, <span class="st">&quot;tiff&quot;</span>, <span class="st">&quot;harmony&quot;</span>, <span class="st">&quot;Matrix&quot;</span>, </span>
<span id="cb7-10"><a href="prerequisites.html#cb7-10" tabindex="-1"></a>                       <span class="st">&quot;CATALYST&quot;</span>, <span class="st">&quot;scuttle&quot;</span>, <span class="st">&quot;scater&quot;</span>, <span class="st">&quot;dittoSeq&quot;</span>, </span>
<span id="cb7-11"><a href="prerequisites.html#cb7-11" tabindex="-1"></a>                       <span class="st">&quot;tidyverse&quot;</span>, <span class="st">&quot;BiocStyle&quot;</span>, <span class="st">&quot;batchelor&quot;</span>, <span class="st">&quot;bluster&quot;</span>, <span class="st">&quot;scran&quot;</span>, </span>
<span id="cb7-12"><a href="prerequisites.html#cb7-12" tabindex="-1"></a>                       <span class="st">&quot;lisaClust&quot;</span>, <span class="st">&quot;spicyR&quot;</span>, <span class="st">&quot;iSEE&quot;</span>, <span class="st">&quot;imcRtools&quot;</span>, <span class="st">&quot;cytomapper&quot;</span>,</span>
<span id="cb7-13"><a href="prerequisites.html#cb7-13" tabindex="-1"></a>                       <span class="st">&quot;imcdatasets&quot;</span>, <span class="st">&quot;cytoviewer&quot;</span>))</span>
<span id="cb7-14"><a href="prerequisites.html#cb7-14" tabindex="-1"></a></span>
<span id="cb7-15"><a href="prerequisites.html#cb7-15" tabindex="-1"></a><span class="co"># Github dependencies</span></span>
<span id="cb7-16"><a href="prerequisites.html#cb7-16" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">&quot;i-cyto/Rphenograph&quot;</span>)</span></code></pre></div>
</div>
<div id="major-package-versions" class="section level3 hasAnchor" number="4.2.3">
<h3><span class="header-section-number">4.2.3</span> Major package versions<a href="prerequisites.html#major-package-versions" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Throughout the analysis, we rely on different R software packages.
This section lists the most commonly used packages in this workflow.</p>
<p>Data containers:</p>
<ul>
<li><a href="https://bioconductor.org/packages/release/bioc/html/SpatialExperiment.html">SpatialExperiment</a> version 1.12.0</li>
<li><a href="https://bioconductor.org/packages/release/bioc/html/SingleCellExperiment.html">SingleCellExperiment</a> version 1.24.0</li>
</ul>
<p>Data analysis:</p>
<ul>
<li><a href="https://bioconductor.org/packages/release/bioc/html/CATALYST.html">CATALYST</a> version 1.26.0</li>
<li><a href="https://bioconductor.org/packages/release/bioc/html/imcRtools.html">imcRtools</a> version 1.8.0</li>
<li><a href="https://bioconductor.org/packages/release/bioc/html/scuttle.html">scuttle</a> version 1.12.0</li>
<li><a href="https://bioconductor.org/packages/release/bioc/html/scater.html">scater</a> version 1.30.1</li>
<li><a href="https://www.bioconductor.org/packages/release/bioc/html/batchelor.html">batchelor</a> version 1.18.1</li>
<li><a href="https://www.bioconductor.org/packages/release/bioc/html/bluster.html">bluster</a> version 1.12.0</li>
<li><a href="https://www.bioconductor.org/packages/release/bioc/html/scran.html">scran</a> version 1.30.0</li>
<li><a href="https://github.com/immunogenomics/harmony">harmony</a> version 1.2.0</li>
<li><a href="https://satijalab.org/seurat/index.html">Seurat</a> version 5.0.1</li>
<li><a href="https://www.bioconductor.org/packages/release/bioc/html/lisaClust.html">lisaClust</a> version 1.10.1</li>
<li><a href="https://topepo.github.io/caret/">caret</a> version 6.0.94</li>
</ul>
<p>Data visualization:</p>
<ul>
<li><a href="https://bioconductor.org/packages/release/bioc/html/cytomapper.html">cytomapper</a> version 1.14.0</li>
<li><a href="https://bioconductor.org/packages/release/bioc/html/cytoviewer.html">cytoviewer</a> version 1.2.0</li>
<li><a href="https://bioconductor.org/packages/release/bioc/html/dittoSeq.html">dittoSeq</a> version 1.14.0</li>
</ul>
<p>Tidy R:</p>
<ul>
<li><a href="https://www.tidyverse.org/">tidyverse</a> version 2.0.0</li>
</ul>
</div>
</div>
<div id="image-processing" class="section level2 hasAnchor" number="4.3">
<h2><span class="header-section-number">4.3</span> Image processing<a href="prerequisites.html#image-processing" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The analysis presented here fully relies on packages written in the programming
language <code>R</code> and primarily focuses on analysis approaches downstream of image
processing. The example data available at
<a href="https://zenodo.org/record/7575859">https://zenodo.org/record/7575859</a> were
processed (file type conversion, image segmentation, feature extraction as
explained in Section <a href="processing.html#processing">3</a>) using the
<a href="https://bodenmillergroup.github.io/steinbock/latest/">steinbock</a> toolkit. The
exact command line interface calls to process the raw data are shown below:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb8-1"><a href="prerequisites.html#cb8-1" tabindex="-1"></a><span class="co">#!/usr/bin/env bash</span></span>
<span id="cb8-2"><a href="prerequisites.html#cb8-2" tabindex="-1"></a><span class="va">BASEDIR</span><span class="op">=</span><span class="va">$(</span><span class="bu">cd</span> <span class="at">--</span> <span class="st">&quot;</span><span class="va">$(</span><span class="fu">dirname</span> <span class="st">&quot;</span><span class="va">${BASH_SOURCE</span><span class="op">[</span><span class="dv">0</span><span class="op">]</span><span class="va">}</span><span class="st">&quot;</span><span class="va">)</span><span class="st">&quot;</span> <span class="kw">&amp;&amp;</span> <span class="bu">pwd</span> <span class="at">-P</span><span class="va">)</span></span>
<span id="cb8-3"><a href="prerequisites.html#cb8-3" tabindex="-1"></a><span class="bu">cd</span> <span class="st">&quot;</span><span class="va">${BASEDIR}</span><span class="st">&quot;</span></span>
<span id="cb8-4"><a href="prerequisites.html#cb8-4" tabindex="-1"></a></span>
<span id="cb8-5"><a href="prerequisites.html#cb8-5" tabindex="-1"></a><span class="co"># raw data collection</span></span>
<span id="cb8-6"><a href="prerequisites.html#cb8-6" tabindex="-1"></a><span class="fu">mkdir</span> raw</span>
<span id="cb8-7"><a href="prerequisites.html#cb8-7" tabindex="-1"></a><span class="fu">wget</span> https://zenodo.org/record/6449127/files/IMCWorkflow.ilp</span>
<span id="cb8-8"><a href="prerequisites.html#cb8-8" tabindex="-1"></a><span class="fu">wget</span> https://zenodo.org/record/6449127/files/analysis.zip</span>
<span id="cb8-9"><a href="prerequisites.html#cb8-9" tabindex="-1"></a><span class="fu">unzip</span> analysis.zip</span>
<span id="cb8-10"><a href="prerequisites.html#cb8-10" tabindex="-1"></a><span class="fu">rm</span> analysis.zip</span>
<span id="cb8-11"><a href="prerequisites.html#cb8-11" tabindex="-1"></a><span class="fu">rm</span> <span class="at">-r</span> analysis/cpinp</span>
<span id="cb8-12"><a href="prerequisites.html#cb8-12" tabindex="-1"></a><span class="fu">rm</span> <span class="at">-r</span> analysis/cpout</span>
<span id="cb8-13"><a href="prerequisites.html#cb8-13" tabindex="-1"></a><span class="fu">rm</span> <span class="at">-r</span> analysis/histocat</span>
<span id="cb8-14"><a href="prerequisites.html#cb8-14" tabindex="-1"></a><span class="fu">rm</span> <span class="at">-r</span> analysis/ilastik</span>
<span id="cb8-15"><a href="prerequisites.html#cb8-15" tabindex="-1"></a><span class="fu">rm</span> <span class="at">-r</span> analysis/ometiff</span>
<span id="cb8-16"><a href="prerequisites.html#cb8-16" tabindex="-1"></a><span class="bu">cd</span> raw</span>
<span id="cb8-17"><a href="prerequisites.html#cb8-17" tabindex="-1"></a><span class="fu">wget</span> https://zenodo.org/record/5949116/files/panel.csv</span>
<span id="cb8-18"><a href="prerequisites.html#cb8-18" tabindex="-1"></a><span class="fu">wget</span> https://zenodo.org/record/5949116/files/Patient1.zip</span>
<span id="cb8-19"><a href="prerequisites.html#cb8-19" tabindex="-1"></a><span class="fu">wget</span> https://zenodo.org/record/5949116/files/Patient2.zip</span>
<span id="cb8-20"><a href="prerequisites.html#cb8-20" tabindex="-1"></a><span class="fu">wget</span> https://zenodo.org/record/5949116/files/Patient3.zip</span>
<span id="cb8-21"><a href="prerequisites.html#cb8-21" tabindex="-1"></a><span class="fu">wget</span> https://zenodo.org/record/5949116/files/Patient4.zip</span>
<span id="cb8-22"><a href="prerequisites.html#cb8-22" tabindex="-1"></a><span class="bu">cd</span> <span class="va">${BASEDIR}</span></span>
<span id="cb8-23"><a href="prerequisites.html#cb8-23" tabindex="-1"></a></span>
<span id="cb8-24"><a href="prerequisites.html#cb8-24" tabindex="-1"></a><span class="co"># steinbock alias setup</span></span>
<span id="cb8-25"><a href="prerequisites.html#cb8-25" tabindex="-1"></a><span class="bu">shopt</span> <span class="at">-s</span> expand_aliases</span>
<span id="cb8-26"><a href="prerequisites.html#cb8-26" tabindex="-1"></a><span class="bu">alias</span> steinbock=<span class="st">&quot;docker run -v </span><span class="va">${BASEDIR}</span><span class="st">:/data -u </span><span class="va">$(</span><span class="fu">id</span> <span class="at">-u</span><span class="va">)</span><span class="st">:</span><span class="va">$(</span><span class="fu">id</span> <span class="at">-g</span><span class="va">)</span><span class="st"> ghcr.io/bodenmillergroup/steinbock:0.16.0&quot;</span></span>
<span id="cb8-27"><a href="prerequisites.html#cb8-27" tabindex="-1"></a></span>
<span id="cb8-28"><a href="prerequisites.html#cb8-28" tabindex="-1"></a><span class="co"># raw data preprocessing</span></span>
<span id="cb8-29"><a href="prerequisites.html#cb8-29" tabindex="-1"></a><span class="ex">steinbock</span> preprocess imc panel <span class="at">--namecol</span> Clean_Target</span>
<span id="cb8-30"><a href="prerequisites.html#cb8-30" tabindex="-1"></a><span class="ex">steinbock</span> preprocess imc images <span class="at">--hpf</span> 50</span>
<span id="cb8-31"><a href="prerequisites.html#cb8-31" tabindex="-1"></a></span>
<span id="cb8-32"><a href="prerequisites.html#cb8-32" tabindex="-1"></a><span class="co"># random forest-based segmentation using Ilastik/CellProfiler</span></span>
<span id="cb8-33"><a href="prerequisites.html#cb8-33" tabindex="-1"></a><span class="ex">steinbock</span> classify ilastik prepare <span class="at">--cropsize</span> 500 <span class="at">--seed</span> 123</span>
<span id="cb8-34"><a href="prerequisites.html#cb8-34" tabindex="-1"></a><span class="fu">rm</span> pixel_classifier.ilp <span class="kw">&amp;&amp;</span> <span class="fu">mv</span> IMCWorkflow.ilp pixel_classifier.ilp</span>
<span id="cb8-35"><a href="prerequisites.html#cb8-35" tabindex="-1"></a><span class="fu">rm</span> <span class="at">-r</span> ilastik_crops <span class="kw">&amp;&amp;</span> <span class="fu">mv</span> analysis/crops ilastik_crops</span>
<span id="cb8-36"><a href="prerequisites.html#cb8-36" tabindex="-1"></a><span class="ex">steinbock</span> classify ilastik fix <span class="at">--no-backup</span></span>
<span id="cb8-37"><a href="prerequisites.html#cb8-37" tabindex="-1"></a><span class="ex">steinbock</span> classify ilastik run</span>
<span id="cb8-38"><a href="prerequisites.html#cb8-38" tabindex="-1"></a><span class="ex">steinbock</span> segment cellprofiler prepare</span>
<span id="cb8-39"><a href="prerequisites.html#cb8-39" tabindex="-1"></a><span class="ex">steinbock</span> segment cellprofiler run <span class="at">-o</span> masks_ilastik</span>
<span id="cb8-40"><a href="prerequisites.html#cb8-40" tabindex="-1"></a></span>
<span id="cb8-41"><a href="prerequisites.html#cb8-41" tabindex="-1"></a><span class="co"># deep learning-based whole-cell segmentation using DeepCell/Mesmer</span></span>
<span id="cb8-42"><a href="prerequisites.html#cb8-42" tabindex="-1"></a><span class="ex">steinbock</span> segment deepcell <span class="at">--app</span> mesmer <span class="at">--minmax</span> <span class="at">-o</span> masks_deepcell</span>
<span id="cb8-43"><a href="prerequisites.html#cb8-43" tabindex="-1"></a></span>
<span id="cb8-44"><a href="prerequisites.html#cb8-44" tabindex="-1"></a><span class="co"># single-cell feature extraction</span></span>
<span id="cb8-45"><a href="prerequisites.html#cb8-45" tabindex="-1"></a><span class="ex">steinbock</span> measure intensities <span class="at">--masks</span> masks_deepcell</span>
<span id="cb8-46"><a href="prerequisites.html#cb8-46" tabindex="-1"></a><span class="ex">steinbock</span> measure regionprops <span class="at">--masks</span> masks_deepcell</span>
<span id="cb8-47"><a href="prerequisites.html#cb8-47" tabindex="-1"></a><span class="ex">steinbock</span> measure neighbors <span class="at">--masks</span> masks_deepcell <span class="at">--type</span> expansion <span class="at">--dmax</span> 4</span>
<span id="cb8-48"><a href="prerequisites.html#cb8-48" tabindex="-1"></a></span>
<span id="cb8-49"><a href="prerequisites.html#cb8-49" tabindex="-1"></a><span class="co"># data export</span></span>
<span id="cb8-50"><a href="prerequisites.html#cb8-50" tabindex="-1"></a><span class="ex">steinbock</span> export ome</span>
<span id="cb8-51"><a href="prerequisites.html#cb8-51" tabindex="-1"></a><span class="ex">steinbock</span> export histocat <span class="at">--masks</span> masks_deepcell</span>
<span id="cb8-52"><a href="prerequisites.html#cb8-52" tabindex="-1"></a><span class="ex">steinbock</span> export csv intensities regionprops <span class="at">-o</span> cells.csv</span>
<span id="cb8-53"><a href="prerequisites.html#cb8-53" tabindex="-1"></a><span class="ex">steinbock</span> export csv intensities regionprops <span class="at">--no-concat</span> <span class="at">-o</span> cells_csv</span>
<span id="cb8-54"><a href="prerequisites.html#cb8-54" tabindex="-1"></a><span class="ex">steinbock</span> export fcs intensities regionprops <span class="at">-o</span> cells.fcs</span>
<span id="cb8-55"><a href="prerequisites.html#cb8-55" tabindex="-1"></a><span class="ex">steinbock</span> export fcs intensities regionprops <span class="at">--no-concat</span> <span class="at">-o</span> cells_fcs</span>
<span id="cb8-56"><a href="prerequisites.html#cb8-56" tabindex="-1"></a><span class="ex">steinbock</span> export anndata <span class="at">--intensities</span> intensities <span class="at">--data</span> regionprops <span class="at">--neighbors</span> neighbors <span class="at">-o</span> cells.h5ad</span>
<span id="cb8-57"><a href="prerequisites.html#cb8-57" tabindex="-1"></a><span class="ex">steinbock</span> export anndata <span class="at">--intensities</span> intensities <span class="at">--data</span> regionprops <span class="at">--neighbors</span> neighbors <span class="at">--no-concat</span> <span class="at">-o</span> cells_h5ad</span>
<span id="cb8-58"><a href="prerequisites.html#cb8-58" tabindex="-1"></a><span class="ex">steinbock</span> export graphs <span class="at">--data</span> intensities</span>
<span id="cb8-59"><a href="prerequisites.html#cb8-59" tabindex="-1"></a></span>
<span id="cb8-60"><a href="prerequisites.html#cb8-60" tabindex="-1"></a><span class="co"># archiving</span></span>
<span id="cb8-61"><a href="prerequisites.html#cb8-61" tabindex="-1"></a><span class="fu">zip</span> <span class="at">-r</span> img.zip img</span>
<span id="cb8-62"><a href="prerequisites.html#cb8-62" tabindex="-1"></a><span class="fu">zip</span> <span class="at">-r</span> ilastik_img.zip ilastik_img</span>
<span id="cb8-63"><a href="prerequisites.html#cb8-63" tabindex="-1"></a><span class="fu">zip</span> <span class="at">-r</span> ilastik_crops.zip ilastik_crops</span>
<span id="cb8-64"><a href="prerequisites.html#cb8-64" tabindex="-1"></a><span class="fu">zip</span> <span class="at">-r</span> ilastik_probabilities.zip ilastik_probabilities</span>
<span id="cb8-65"><a href="prerequisites.html#cb8-65" tabindex="-1"></a><span class="fu">zip</span> <span class="at">-r</span> masks_ilastik.zip masks_ilastik</span>
<span id="cb8-66"><a href="prerequisites.html#cb8-66" tabindex="-1"></a><span class="fu">zip</span> <span class="at">-r</span> masks_deepcell.zip masks_deepcell</span>
<span id="cb8-67"><a href="prerequisites.html#cb8-67" tabindex="-1"></a><span class="fu">zip</span> <span class="at">-r</span> intensities.zip intensities</span>
<span id="cb8-68"><a href="prerequisites.html#cb8-68" tabindex="-1"></a><span class="fu">zip</span> <span class="at">-r</span> regionprops.zip regionprops</span>
<span id="cb8-69"><a href="prerequisites.html#cb8-69" tabindex="-1"></a><span class="fu">zip</span> <span class="at">-r</span> neighbors.zip neighbors</span>
<span id="cb8-70"><a href="prerequisites.html#cb8-70" tabindex="-1"></a><span class="fu">zip</span> <span class="at">-r</span> ome.zip ome</span>
<span id="cb8-71"><a href="prerequisites.html#cb8-71" tabindex="-1"></a><span class="fu">zip</span> <span class="at">-r</span> histocat.zip histocat</span>
<span id="cb8-72"><a href="prerequisites.html#cb8-72" tabindex="-1"></a><span class="fu">zip</span> <span class="at">-r</span> cells_csv.zip cells_csv</span>
<span id="cb8-73"><a href="prerequisites.html#cb8-73" tabindex="-1"></a><span class="fu">zip</span> <span class="at">-r</span> cells_fcs.zip cells_fcs</span>
<span id="cb8-74"><a href="prerequisites.html#cb8-74" tabindex="-1"></a><span class="fu">zip</span> <span class="at">-r</span> cells_h5ad.zip cells_h5ad</span>
<span id="cb8-75"><a href="prerequisites.html#cb8-75" tabindex="-1"></a><span class="fu">zip</span> <span class="at">-r</span> graphs.zip graphs</span></code></pre></div>
</div>
<div id="download-data" class="section level2 hasAnchor" number="4.4">
<h2><span class="header-section-number">4.4</span> Download example data<a href="prerequisites.html#download-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Throughout this tutorial, we will access a number of different data types.
To declutter the analysis scripts, we will already download all needed data here.</p>
<p>To highlight the basic steps of IMC data analysis, we provide example data that
were acquired as part of the <strong>I</strong>ntegrated i<strong>MMU</strong>noprofiling of large adaptive
<strong>CAN</strong>cer patient cohorts projects (<a href="https://immucan.eu/">immucan.eu</a>). The
raw data of 4 patients can be accessed online at
<a href="https://zenodo.org/record/7575859">zenodo.org/record/7575859</a>. We will only
download the sample/patient metadata information here:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="prerequisites.html#cb9-1" tabindex="-1"></a><span class="fu">download.file</span>(<span class="st">&quot;https://zenodo.org/record/7575859/files/sample_metadata.csv&quot;</span>, </span>
<span id="cb9-2"><a href="prerequisites.html#cb9-2" tabindex="-1"></a>         <span class="at">destfile =</span> <span class="st">&quot;data/sample_metadata.csv&quot;</span>)</span></code></pre></div>
<div id="processed-multiplexed-imaging-data" class="section level3 hasAnchor" number="4.4.1">
<h3><span class="header-section-number">4.4.1</span> Processed multiplexed imaging data<a href="prerequisites.html#processed-multiplexed-imaging-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The IMC raw data was either processed using the
<a href="https://github.com/BodenmillerGroup/steinbock">steinbock</a> toolkit or the
<a href="https://github.com/BodenmillerGroup/ImcSegmentationPipeline">IMC Segmentation Pipeline</a>.
Image processing included file type conversion, cell segmentation and feature
extraction.</p>
<p><strong>steinbock output</strong></p>
<p>This book uses the output of the <code>steinbock</code> framework when applied to process
the example data. The processed data includes the single-cell mean intensity
files, the single-cell morphological features and spatial locations, spatial
object graphs in form of edge lists indicating cells in close proximity, hot
pixel filtered multi-channel images, segmentation masks, image metadata and
channel metadata. All these files will be downloaded here for later use. The
commands which were used to generate this data can be found in the shell script
above.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="prerequisites.html#cb10-1" tabindex="-1"></a><span class="co"># download intensities</span></span>
<span id="cb10-2"><a href="prerequisites.html#cb10-2" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="st">&quot;https://zenodo.org/record/7624451/files/intensities.zip&quot;</span></span>
<span id="cb10-3"><a href="prerequisites.html#cb10-3" tabindex="-1"></a>destfile <span class="ot">&lt;-</span> <span class="st">&quot;data/steinbock/intensities.zip&quot;</span></span>
<span id="cb10-4"><a href="prerequisites.html#cb10-4" tabindex="-1"></a><span class="fu">download.file</span>(url, destfile)</span>
<span id="cb10-5"><a href="prerequisites.html#cb10-5" tabindex="-1"></a><span class="fu">unzip</span>(destfile, <span class="at">exdir=</span><span class="st">&quot;data/steinbock&quot;</span>, <span class="at">overwrite=</span><span class="cn">TRUE</span>)</span>
<span id="cb10-6"><a href="prerequisites.html#cb10-6" tabindex="-1"></a><span class="fu">unlink</span>(destfile)</span>
<span id="cb10-7"><a href="prerequisites.html#cb10-7" tabindex="-1"></a></span>
<span id="cb10-8"><a href="prerequisites.html#cb10-8" tabindex="-1"></a><span class="co"># download regionprops</span></span>
<span id="cb10-9"><a href="prerequisites.html#cb10-9" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="st">&quot;https://zenodo.org/record/7624451/files/regionprops.zip&quot;</span></span>
<span id="cb10-10"><a href="prerequisites.html#cb10-10" tabindex="-1"></a>destfile <span class="ot">&lt;-</span> <span class="st">&quot;data/steinbock/regionprops.zip&quot;</span></span>
<span id="cb10-11"><a href="prerequisites.html#cb10-11" tabindex="-1"></a><span class="fu">download.file</span>(url, destfile)</span>
<span id="cb10-12"><a href="prerequisites.html#cb10-12" tabindex="-1"></a><span class="fu">unzip</span>(destfile, <span class="at">exdir=</span><span class="st">&quot;data/steinbock&quot;</span>, <span class="at">overwrite=</span><span class="cn">TRUE</span>)</span>
<span id="cb10-13"><a href="prerequisites.html#cb10-13" tabindex="-1"></a><span class="fu">unlink</span>(destfile)</span>
<span id="cb10-14"><a href="prerequisites.html#cb10-14" tabindex="-1"></a></span>
<span id="cb10-15"><a href="prerequisites.html#cb10-15" tabindex="-1"></a><span class="co"># download neighbors</span></span>
<span id="cb10-16"><a href="prerequisites.html#cb10-16" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="st">&quot;https://zenodo.org/record/7624451/files/neighbors.zip&quot;</span></span>
<span id="cb10-17"><a href="prerequisites.html#cb10-17" tabindex="-1"></a>destfile <span class="ot">&lt;-</span> <span class="st">&quot;data/steinbock/neighbors.zip&quot;</span></span>
<span id="cb10-18"><a href="prerequisites.html#cb10-18" tabindex="-1"></a><span class="fu">download.file</span>(url, destfile)</span>
<span id="cb10-19"><a href="prerequisites.html#cb10-19" tabindex="-1"></a><span class="fu">unzip</span>(destfile, <span class="at">exdir=</span><span class="st">&quot;data/steinbock&quot;</span>, <span class="at">overwrite=</span><span class="cn">TRUE</span>)</span>
<span id="cb10-20"><a href="prerequisites.html#cb10-20" tabindex="-1"></a><span class="fu">unlink</span>(destfile)</span>
<span id="cb10-21"><a href="prerequisites.html#cb10-21" tabindex="-1"></a></span>
<span id="cb10-22"><a href="prerequisites.html#cb10-22" tabindex="-1"></a><span class="co"># download images</span></span>
<span id="cb10-23"><a href="prerequisites.html#cb10-23" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="st">&quot;https://zenodo.org/record/7624451/files/img.zip&quot;</span></span>
<span id="cb10-24"><a href="prerequisites.html#cb10-24" tabindex="-1"></a>destfile <span class="ot">&lt;-</span> <span class="st">&quot;data/steinbock/img.zip&quot;</span></span>
<span id="cb10-25"><a href="prerequisites.html#cb10-25" tabindex="-1"></a><span class="fu">download.file</span>(url, destfile)</span>
<span id="cb10-26"><a href="prerequisites.html#cb10-26" tabindex="-1"></a><span class="fu">unzip</span>(destfile, <span class="at">exdir=</span><span class="st">&quot;data/steinbock&quot;</span>, <span class="at">overwrite=</span><span class="cn">TRUE</span>)</span>
<span id="cb10-27"><a href="prerequisites.html#cb10-27" tabindex="-1"></a><span class="fu">unlink</span>(destfile)</span>
<span id="cb10-28"><a href="prerequisites.html#cb10-28" tabindex="-1"></a></span>
<span id="cb10-29"><a href="prerequisites.html#cb10-29" tabindex="-1"></a><span class="co"># download masks</span></span>
<span id="cb10-30"><a href="prerequisites.html#cb10-30" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="st">&quot;https://zenodo.org/record/7624451/files/masks_deepcell.zip&quot;</span></span>
<span id="cb10-31"><a href="prerequisites.html#cb10-31" tabindex="-1"></a>destfile <span class="ot">&lt;-</span> <span class="st">&quot;data/steinbock/masks_deepcell.zip&quot;</span></span>
<span id="cb10-32"><a href="prerequisites.html#cb10-32" tabindex="-1"></a><span class="fu">download.file</span>(url, destfile)</span>
<span id="cb10-33"><a href="prerequisites.html#cb10-33" tabindex="-1"></a><span class="fu">unzip</span>(destfile, <span class="at">exdir=</span><span class="st">&quot;data/steinbock&quot;</span>, <span class="at">overwrite=</span><span class="cn">TRUE</span>)</span>
<span id="cb10-34"><a href="prerequisites.html#cb10-34" tabindex="-1"></a><span class="fu">unlink</span>(destfile)</span>
<span id="cb10-35"><a href="prerequisites.html#cb10-35" tabindex="-1"></a></span>
<span id="cb10-36"><a href="prerequisites.html#cb10-36" tabindex="-1"></a><span class="co"># download individual files</span></span>
<span id="cb10-37"><a href="prerequisites.html#cb10-37" tabindex="-1"></a><span class="fu">download.file</span>(<span class="st">&quot;https://zenodo.org/record/7624451/files/panel.csv&quot;</span>, </span>
<span id="cb10-38"><a href="prerequisites.html#cb10-38" tabindex="-1"></a>              <span class="st">&quot;data/steinbock/panel.csv&quot;</span>)</span>
<span id="cb10-39"><a href="prerequisites.html#cb10-39" tabindex="-1"></a><span class="fu">download.file</span>(<span class="st">&quot;https://zenodo.org/record/7624451/files/images.csv&quot;</span>, </span>
<span id="cb10-40"><a href="prerequisites.html#cb10-40" tabindex="-1"></a>              <span class="st">&quot;data/steinbock/images.csv&quot;</span>)</span>
<span id="cb10-41"><a href="prerequisites.html#cb10-41" tabindex="-1"></a><span class="fu">download.file</span>(<span class="st">&quot;https://zenodo.org/record/7624451/files/steinbock.sh&quot;</span>, </span>
<span id="cb10-42"><a href="prerequisites.html#cb10-42" tabindex="-1"></a>              <span class="st">&quot;data/steinbock/steinbock.sh&quot;</span>)</span></code></pre></div>
<p><strong>IMC Segmentation Pipeline output</strong></p>
<p>The example data was also processed using the
<a href="https://github.com/BodenmillerGroup/ImcSegmentationPipeline">IMC Segmetation Pipeline</a> (version 3).
To highlight the use of the reader function for this type of output, we will need
to download the <code>cpout</code> folder which is part of the <code>analysis</code> folder. The <code>cpout</code>
folder stores all relevant output files of the pipeline. For a full description
of the pipeline, please refer to the <a href="https://bodenmillergroup.github.io/ImcSegmentationPipeline/">docs</a>.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="prerequisites.html#cb11-1" tabindex="-1"></a><span class="co"># download analysis folder</span></span>
<span id="cb11-2"><a href="prerequisites.html#cb11-2" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="st">&quot;https://zenodo.org/record/7997296/files/analysis.zip&quot;</span></span>
<span id="cb11-3"><a href="prerequisites.html#cb11-3" tabindex="-1"></a>destfile <span class="ot">&lt;-</span> <span class="st">&quot;data/ImcSegmentationPipeline/analysis.zip&quot;</span></span>
<span id="cb11-4"><a href="prerequisites.html#cb11-4" tabindex="-1"></a><span class="fu">download.file</span>(url, destfile)</span>
<span id="cb11-5"><a href="prerequisites.html#cb11-5" tabindex="-1"></a><span class="fu">unzip</span>(destfile, <span class="at">exdir=</span><span class="st">&quot;data/ImcSegmentationPipeline&quot;</span>, <span class="at">overwrite=</span><span class="cn">TRUE</span>)</span>
<span id="cb11-6"><a href="prerequisites.html#cb11-6" tabindex="-1"></a><span class="fu">unlink</span>(destfile)</span>
<span id="cb11-7"><a href="prerequisites.html#cb11-7" tabindex="-1"></a></span>
<span id="cb11-8"><a href="prerequisites.html#cb11-8" tabindex="-1"></a><span class="fu">unlink</span>(<span class="st">&quot;data/ImcSegmentationPipeline/analysis/cpinp/&quot;</span>, <span class="at">recursive=</span><span class="cn">TRUE</span>)</span>
<span id="cb11-9"><a href="prerequisites.html#cb11-9" tabindex="-1"></a><span class="fu">unlink</span>(<span class="st">&quot;data/ImcSegmentationPipeline/analysis/crops/&quot;</span>, <span class="at">recursive=</span><span class="cn">TRUE</span>)</span>
<span id="cb11-10"><a href="prerequisites.html#cb11-10" tabindex="-1"></a><span class="fu">unlink</span>(<span class="st">&quot;data/ImcSegmentationPipeline/analysis/histocat/&quot;</span>, <span class="at">recursive=</span><span class="cn">TRUE</span>)</span>
<span id="cb11-11"><a href="prerequisites.html#cb11-11" tabindex="-1"></a><span class="fu">unlink</span>(<span class="st">&quot;data/ImcSegmentationPipeline/analysis/ilastik/&quot;</span>, <span class="at">recursive=</span><span class="cn">TRUE</span>)</span>
<span id="cb11-12"><a href="prerequisites.html#cb11-12" tabindex="-1"></a><span class="fu">unlink</span>(<span class="st">&quot;data/ImcSegmentationPipeline/analysis/ometiff/&quot;</span>, <span class="at">recursive=</span><span class="cn">TRUE</span>)</span>
<span id="cb11-13"><a href="prerequisites.html#cb11-13" tabindex="-1"></a><span class="fu">unlink</span>(<span class="st">&quot;data/ImcSegmentationPipeline/analysis/cpout/images/&quot;</span>, <span class="at">recursive=</span><span class="cn">TRUE</span>)</span>
<span id="cb11-14"><a href="prerequisites.html#cb11-14" tabindex="-1"></a><span class="fu">unlink</span>(<span class="st">&quot;data/ImcSegmentationPipeline/analysis/cpout/probabilities/&quot;</span>, <span class="at">recursive=</span><span class="cn">TRUE</span>)</span>
<span id="cb11-15"><a href="prerequisites.html#cb11-15" tabindex="-1"></a><span class="fu">unlink</span>(<span class="st">&quot;data/ImcSegmentationPipeline/analysis/cpout/masks/&quot;</span>, <span class="at">recursive=</span><span class="cn">TRUE</span>)</span></code></pre></div>
</div>
<div id="files-for-spillover-matrix-estimation" class="section level3 hasAnchor" number="4.4.2">
<h3><span class="header-section-number">4.4.2</span> Files for spillover matrix estimation<a href="prerequisites.html#files-for-spillover-matrix-estimation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To highlight the estimation and correction of channel-spillover as described by
<span class="citation">(<a href="#ref-Chevrier2017">Chevrier et al. 2017</a>)</span>, we can access an example spillover-acquisition from:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="prerequisites.html#cb12-1" tabindex="-1"></a><span class="fu">download.file</span>(<span class="st">&quot;https://zenodo.org/record/7575859/files/compensation.zip&quot;</span>,</span>
<span id="cb12-2"><a href="prerequisites.html#cb12-2" tabindex="-1"></a>              <span class="st">&quot;data/compensation.zip&quot;</span>)</span>
<span id="cb12-3"><a href="prerequisites.html#cb12-3" tabindex="-1"></a><span class="fu">unzip</span>(<span class="st">&quot;data/compensation.zip&quot;</span>, <span class="at">exdir=</span><span class="st">&quot;data&quot;</span>, <span class="at">overwrite=</span><span class="cn">TRUE</span>)</span>
<span id="cb12-4"><a href="prerequisites.html#cb12-4" tabindex="-1"></a><span class="fu">unlink</span>(<span class="st">&quot;data/compensation.zip&quot;</span>)</span></code></pre></div>
</div>
<div id="gated-cells" class="section level3 hasAnchor" number="4.4.3">
<h3><span class="header-section-number">4.4.3</span> Gated cells<a href="prerequisites.html#gated-cells" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In Section <a href="cell-phenotyping.html#classification">9.3</a>, we present a cell type classification approach
that relies on previously gated cells. This ground truth data is available
online at <a href="https://zenodo.org/record/8095133">zenodo.org/record/8095133</a> and
will be downloaded here for later use:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="prerequisites.html#cb13-1" tabindex="-1"></a><span class="fu">download.file</span>(<span class="st">&quot;https://zenodo.org/record/8095133/files/gated_cells.zip&quot;</span>,</span>
<span id="cb13-2"><a href="prerequisites.html#cb13-2" tabindex="-1"></a>              <span class="st">&quot;data/gated_cells.zip&quot;</span>)</span>
<span id="cb13-3"><a href="prerequisites.html#cb13-3" tabindex="-1"></a><span class="fu">unzip</span>(<span class="st">&quot;data/gated_cells.zip&quot;</span>, <span class="at">exdir=</span><span class="st">&quot;data&quot;</span>, <span class="at">overwrite=</span><span class="cn">TRUE</span>)</span>
<span id="cb13-4"><a href="prerequisites.html#cb13-4" tabindex="-1"></a><span class="fu">unlink</span>(<span class="st">&quot;data/gated_cells.zip&quot;</span>)</span></code></pre></div>
</div>
</div>
<div id="sessionInfo" class="section level2 hasAnchor" number="4.5">
<h2><span class="header-section-number">4.5</span> Software versions<a href="prerequisites.html#sessionInfo" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<details>
<summary>
SessionInfo
</summary>
<pre><code>## R version 4.3.2 (2023-10-31)
## Platform: x86_64-pc-linux-gnu (64-bit)
## Running under: Ubuntu 22.04.3 LTS
## 
## Matrix products: default
## BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3 
## LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.20.so;  LAPACK version 3.10.0
## 
## locale:
##  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              
##  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8    
##  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8   
##  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                 
##  [9] LC_ADDRESS=C               LC_TELEPHONE=C            
## [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       
## 
## time zone: Etc/UTC
## tzcode source: system (glibc)
## 
## attached base packages:
## [1] stats4    stats     graphics  grDevices utils     datasets  methods  
## [8] base     
## 
## other attached packages:
##  [1] cytoviewer_1.2.0            caret_6.0-94               
##  [3] lattice_0.21-9              lisaClust_1.10.1           
##  [5] scran_1.30.0                bluster_1.12.0             
##  [7] lubridate_1.9.3             forcats_1.0.0              
##  [9] stringr_1.5.1               dplyr_1.1.4                
## [11] purrr_1.0.2                 readr_2.1.4                
## [13] tidyr_1.3.0                 tibble_3.2.1               
## [15] tidyverse_2.0.0             dittoSeq_1.14.0            
## [17] cytomapper_1.14.0           EBImage_4.44.0             
## [19] imcRtools_1.8.0             scater_1.30.1              
## [21] ggplot2_3.4.4               scuttle_1.12.0             
## [23] SpatialExperiment_1.12.0    CATALYST_1.26.0            
## [25] SingleCellExperiment_1.24.0 SummarizedExperiment_1.32.0
## [27] Biobase_2.62.0              GenomicRanges_1.54.1       
## [29] GenomeInfoDb_1.38.5         IRanges_2.36.0             
## [31] S4Vectors_0.40.2            BiocGenerics_0.48.1        
## [33] MatrixGenerics_1.14.0       matrixStats_1.2.0          
## 
## loaded via a namespace (and not attached):
##   [1] vroom_1.6.5                 tiff_0.1-12                
##   [3] nnet_7.3-19                 goftest_1.2-3              
##   [5] DT_0.31                     HDF5Array_1.30.0           
##   [7] TH.data_1.1-2               vctrs_0.6.5                
##   [9] spatstat.random_3.2-2       digest_0.6.33              
##  [11] png_0.1-8                   shape_1.4.6                
##  [13] proxy_0.4-27                ggrepel_0.9.4              
##  [15] spicyR_1.14.2               deldir_2.0-2               
##  [17] parallelly_1.36.0           magick_2.8.2               
##  [19] MASS_7.3-60                 reshape2_1.4.4             
##  [21] httpuv_1.6.13               foreach_1.5.2              
##  [23] withr_2.5.2                 xfun_0.41                  
##  [25] ggpubr_0.6.0                ellipsis_0.3.2             
##  [27] survival_3.5-7              RTriangle_1.6-0.12         
##  [29] ggbeeswarm_0.7.2            RProtoBufLib_2.14.0        
##  [31] drc_3.0-1                   systemfonts_1.0.5          
##  [33] zoo_1.8-12                  GlobalOptions_0.1.2        
##  [35] gtools_3.9.5                promises_1.2.1             
##  [37] rstatix_0.7.2               globals_0.16.2             
##  [39] rhdf5filters_1.14.1         rhdf5_2.46.1               
##  [41] miniUI_0.1.1.1              archive_1.1.7              
##  [43] units_0.8-5                 generics_0.1.3             
##  [45] concaveman_1.1.0            zlibbioc_1.48.0            
##  [47] ScaledMatrix_1.10.0         ggraph_2.1.0               
##  [49] polyclip_1.10-6             GenomeInfoDbData_1.2.11    
##  [51] SparseArray_1.2.3           fftwtools_0.9-11           
##  [53] xtable_1.8-4                doParallel_1.0.17          
##  [55] evaluate_0.23               S4Arrays_1.2.0             
##  [57] hms_1.1.3                   bookdown_0.37              
##  [59] irlba_2.3.5.1               colorspace_2.1-0           
##  [61] spatstat.data_3.0-3         magrittr_2.0.3             
##  [63] later_1.3.2                 viridis_0.6.4              
##  [65] spatstat.geom_3.2-7         future.apply_1.11.1        
##  [67] XML_3.99-0.16               cowplot_1.1.2              
##  [69] class_7.3-22                svgPanZoom_0.3.4           
##  [71] pillar_1.9.0                nlme_3.1-163               
##  [73] iterators_1.0.14            compiler_4.3.2             
##  [75] beachmat_2.18.0             shinycssloaders_1.0.0      
##  [77] stringi_1.8.3               gower_1.0.1                
##  [79] sf_1.0-15                   tensor_1.5                 
##  [81] minqa_1.2.6                 ClassifyR_3.6.2            
##  [83] plyr_1.8.9                  crayon_1.5.2               
##  [85] abind_1.4-5                 locfit_1.5-9.8             
##  [87] sp_2.1-2                    graphlayouts_1.0.2         
##  [89] bit_4.0.5                   terra_1.7-65               
##  [91] sandwich_3.1-0              codetools_0.2-19           
##  [93] multcomp_1.4-25             recipes_1.0.9              
##  [95] BiocSingular_1.18.0         bslib_0.6.1                
##  [97] e1071_1.7-14                GetoptLong_1.0.5           
##  [99] mime_0.12                   MultiAssayExperiment_1.28.0
## [101] splines_4.3.2               circlize_0.4.15            
## [103] Rcpp_1.0.11                 sparseMatrixStats_1.14.0   
## [105] knitr_1.45                  utf8_1.2.4                 
## [107] clue_0.3-65                 lme4_1.1-35.1              
## [109] listenv_0.9.0               nnls_1.5                   
## [111] DelayedMatrixStats_1.24.0   ggsignif_0.6.4             
## [113] Matrix_1.6-4                scam_1.2-14                
## [115] statmod_1.5.0               tzdb_0.4.0                 
## [117] svglite_2.1.3               tweenr_2.0.2               
## [119] pkgconfig_2.0.3             pheatmap_1.0.12            
## [121] tools_4.3.2                 cachem_1.0.8               
## [123] viridisLite_0.4.2           DBI_1.2.0                  
## [125] numDeriv_2016.8-1.1         fastmap_1.1.1              
## [127] rmarkdown_2.25              scales_1.3.0               
## [129] grid_4.3.2                  shinydashboard_0.7.2       
## [131] broom_1.0.5                 sass_0.4.8                 
## [133] carData_3.0-5               rpart_4.1.21               
## [135] farver_2.1.1                tidygraph_1.3.0            
## [137] mgcv_1.9-0                  yaml_2.3.8                 
## [139] cli_3.6.2                   lifecycle_1.0.4            
## [141] mvtnorm_1.2-4               lava_1.7.3                 
## [143] backports_1.4.1             BiocParallel_1.36.0        
## [145] cytolib_2.14.0              timechange_0.2.0           
## [147] gtable_0.3.4                rjson_0.2.21               
## [149] ggridges_0.5.5              parallel_4.3.2             
## [151] pROC_1.18.5                 limma_3.58.1               
## [153] colourpicker_1.3.0          jsonlite_1.8.8             
## [155] edgeR_4.0.3                 bitops_1.0-7               
## [157] bit64_4.0.5                 Rtsne_0.17                 
## [159] FlowSOM_2.10.0              spatstat.utils_3.0-4       
## [161] BiocNeighbors_1.20.1        flowCore_2.14.0            
## [163] jquerylib_0.1.4             metapod_1.10.1             
## [165] dqrng_0.3.2                 timeDate_4032.109          
## [167] shiny_1.8.0                 ConsensusClusterPlus_1.66.0
## [169] htmltools_0.5.7             distances_0.1.10           
## [171] glue_1.6.2                  XVector_0.42.0             
## [173] RCurl_1.98-1.13             classInt_0.4-10            
## [175] jpeg_0.1-10                 gridExtra_2.3              
## [177] boot_1.3-28.1               igraph_1.6.0               
## [179] R6_2.5.1                    cluster_2.1.4              
## [181] Rhdf5lib_1.24.1             ipred_0.9-14               
## [183] nloptr_2.0.3                DelayedArray_0.28.0        
## [185] tidyselect_1.2.0            vipor_0.4.7                
## [187] plotrix_3.8-4               ggforce_0.4.1              
## [189] raster_3.6-26               car_3.1-2                  
## [191] future_1.33.1               ModelMetrics_1.2.2.2       
## [193] rsvd_1.0.5                  munsell_0.5.0              
## [195] KernSmooth_2.23-22          data.table_1.14.10         
## [197] htmlwidgets_1.6.4           ComplexHeatmap_2.18.0      
## [199] RColorBrewer_1.1-3          rlang_1.1.2                
## [201] spatstat.sparse_3.0-3       spatstat.explore_3.2-5     
## [203] lmerTest_3.1-3              colorRamps_2.3.1           
## [205] ggnewscale_0.4.9            fansi_1.0.6                
## [207] hardhat_1.3.0               beeswarm_0.4.0             
## [209] prodlim_2023.08.28</code></pre>
</details>

</div>
</div>
<h3>References<a href="references.html#references" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Chevrier2017" class="csl-entry">
Chevrier, Stéphane, Helena L. Crowell, Vito R. T. Zanotelli, Stefanie Engler, Mark D. Robinson, and Bernd Bodenmiller. 2017. <span>“Compensation of Signal Spillover in Suspension and Imaging Mass Cytometry.”</span> <em>Cell Systems</em> 6: 612–20.
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="processing.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="read-data.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": true,
"linkedin": true,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/BodenmillerGroup/IMCDataAnalysis/blob/master/03-prerequisites.Rmd",
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
